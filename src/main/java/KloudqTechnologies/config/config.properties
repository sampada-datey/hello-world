
ECActualPredictive=SELECT COALESCE(SUM(l.\"TotalKwH\"), 0.0), (COALESCE(SUM(l.\"TotalKwH\"), 0.0) / date_part (\'hour\', (SELECT l0.\"LastModified\" FROM public.\"LenzDailyData\" AS l0 INNER JOIN (SELECT b0.\"EquipmentId\", b0.\"Active\", b0.\"CompanyId\", b0.\"Created\", b0.\"CreatedBy\", b0.\"Description\", b0.\"DeviceId\", b0.\"EquipmentCode\", b0.\"Hierarchyid\", b0.\"Label1\", b0.\"Label2\", b0.\"Label3\", b0.\"Label4\", b0.\"Label5\", b0.\"LastModified\", b0.\"LastModifiedBy\", b0.\"Latitude\", b0.\"Location\", b0.\"Longitude\", b0.\"ModelId\", b0.\"SiteId\", b0.\"SubCategoryId\", e0.\"AmpereRating\", e0.\"BaudRate\", e0.\"BreakingCapacity\", e0.\"Capacity\", e0.\"CommandString\", e0.\"HierarchyPath\", e0.\"IsBBTempMonitored\", e0.\"IsBSConnected\", e0.\"IsCalculation\", e0.\"IsGenset\", e0.\"IsLMConnected\", e0.\"IsVirtualMeter\", e0.\"LenzEquipmentType\", e0.\"LowLoadConsumption\", e0.\"MeterNo\", e0.\"MeterType\", e0.\"ParentEquipmentHierarchyID\", e0.\"Parity\", e0.\"RatedLoading\", e0.\"RatedPower\", e0.\"SlaveID\", e0.\"StopBit\", e0.\"TankCapacity\", e0.\"TankSize\", e0.\"TypeOfBreaker\" FROM public.\"BaseEquipment\" AS b0 INNER JOIN \"EquipmentHierarchy\" AS e0 ON b0.\"EquipmentId\" = e0.\"EquipmentId\" WHERE b0.\"CompanyId\" = 5) AS t1 ON l0.\"EquipmentId\" = t1.\"EquipmentId\" INNER JOIN (SELECT s0.\"SubCategoryId\", s0.\"CompanyId\", s0.\"Created\", s0.\"CreatedBy\", s0.\"ImageUrl\", s0.\"LastModified\", s0.\"LastModifiedBy\", s0.\"ProductCategoryID\", s0.\"SubCategoryCode\", s0.\"SubCategoryName\" FROM public.\"SubCategory\" AS s0 WHERE s0.\"CompanyId\" = 5) AS t2 ON t1.\"SubCategoryId\" = t2.\"SubCategoryId\" WHERE ((l0.\"CompanyId\" =5) AND ((((t1.\"CompanyId\" = 5) AND (date_trunc(\'day\', l0.\"Date\")= date_trunc(\'day\', now() AT TIME ZONE \'UTC\'))) AND ((t2.\"SubCategoryCode\" = \'Mains\') OR t1.\"IsCalculation\")) AND (t1.\"MeterType\" = 1))) AND ((date_trunc(\'day\', now() AT TIME ZONE \'UTC\') = date_trunc(\'day\', now() AT TIME ZONE \'UTC\')) OR now() AT TIME ZONE \'UTC\' IS NULL) LIMIT 1))::INT::double precision) * 24 FROM public.\"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"CompanyId\", b.\"SubCategoryId\", e.\"IsCalculation\", e.\"MeterType\" FROM public.\"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public.\"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\"= t0.\"SubCategoryId\" WHERE (l.\"CompanyId\" = 5) AND ((((t.\"CompanyId\" = 5) AND (date_trunc(\'day\', l.\"Date\") = date_trunc(\'day\', now() AT TIME ZONE \'UTC\'))) AND ((t0.\"SubCategoryCode\" = \'Mains\') OR t.\"IsCalculation\")) AND (t.\"MeterType\" = 1)) GROUP BY date_trunc(\'day\', now() AT TIME ZONE \'UTC\') LIMIT 2
CostActualPredictive=SELECT COALESCE(SUM(l.\"Cost\"), 0.0) AS \"TotalCostUnit\", CASE WHEN COALESCE(SUM(l.\"Cost\"), 0.0) > 0.0 THEN CAST(((COALESCE(SUM(l.\"Cost\"), 0.0) / date_part(\'hour\', (SELECT l0.\"LastModified\" FROM public. \"LenzDailyData\" AS l0 INNER JOIN (SELECT b0.\"EquipmentId\", b0.\"Active\", b0.\"CompanyId\", b0.\"Created\", b0.\"CreatedBy\", b0.\"Description\", b0.\"DeviceId\", b0.\"EquipmentCode\", b0.\"Hierarchyid\", b0.\"Label1\", b0.\"Label2\", b0.\"Label3\", b0.\"Label4\", b0.\"Label5\", b0.\"LastModified\", b0.\"LastModifiedBy\", b0.\"Latitude\", b0.\"Location\", b0.\"Longitude\", b0.\"ModelId\", b0.\"SiteId\", b0.\"SubCategoryId\", e0.\"AmpereRating\", e0.\"BaudRate\", e0.\"BreakingCapacity\", e0.\"Capacity\", e0.\"CommandString\", e0.\"HierarchyPath\", e0.\"IsBBTempMonitored\", e0.\"IsBSConnected\", e0.\"IsGenset\", e0.\"IsLMConnected\", e0.\"IsVirtualMeter\", e0.\"LenzEquipmentType\", e0.\"LowLoadConsumption\", e0.\"MeterNo\", e0.\"MeterType\", e0.\"ParentEquipmentHierarchyID\", e0.\"Parity\", e0.\"RatedLoading\", e0.\"RatedPower\", e0.\"SlaveID\", e0.\"StopBit\", e0.\"TankCapacity\", e0.\"TankSize\", e0.\"TypeOfBreaker\" FROM public. \"BaseEquipment\" AS b0 INNER JOIN \"EquipmentHierarchy\" AS e0 ON b0.\"EquipmentId\" = e0.\"EquipmentId\" WHERE b0.\"CompanyId\" = 5) AS t1 ON l0.\"EquipmentId\" = t1.\"EquipmentId\"INNER JOIN (SELECT s0.\"SubCategoryId\", s0.\"CompanyId\", s0.\"Created\", s0.\"CreatedBy\", s0.\"ImageUrl\", s0.\"LastModified\", s0.\"LastModifiedBy\", s0.\"ProductCategoryID\", s0.\"SubCategoryCode\", s0.\"SubCategoryName\" FROM public. \"SubCategory\" AS s0 WHERE s0.\"CompanyId\" = 5) AS t2 ON t1.\"SubCategoryId\" = t2.\"SubCategoryId\" WHERE ((l0.\"CompanyId\" = 5) AND (((((t1.\"CompanyId\" = 5) AND (date_trunc(\'day\', l0.\"
\") = date_trunc(\'day\', now() AT TIME ZONE \'UTC\'))) AND ((t2.\"SubCategoryCode\" = \'Mains\'))) AND (t1.\"MeterType\" = 1)) AND t1.\"Active\")) AND (l.\"Date\" = l0.\"Date\")LIMIT 1))::INT::numeric) * 24.0) AS numeric)ELSE 0.0 END AS \"PredTotalCostUnit\"FROM public. \"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"Active\", b.\"CompanyId\", b.\"SubCategoryId\", e.\"MeterType\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\"INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public. \"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\" = t0.\"SubCategoryId\" WHERE (l.\"CompanyId\" = 5) AND (((((t.\"CompanyId\" = 5) AND (date_trunc(\'day\', l.\"Date\") = date_trunc(\'day\', now() AT TIME ZONE \'UTC\'))) AND ((t0.\"SubCategoryCode\" = \'Mains\'))) AND (t.\"MeterType\" = 1)) AND t.\"Active\")GROUP BY l.\"Date\" LIMIT 2
AvgKwhToday=SELECT COUNT(DISTINCT (CASE WHEN NOT (t1.\"IsHoliday\") THEN t1.\"Date\" END))::INT::double precision, COALESCE(SUM(t1.\"TotalKwH\"), 0.0) FROM (SELECT l.\"Date\", l.\"IsHoliday\", l.\"TotalKwH\", 1 AS \"Key\" FROM public.\"LenzDailyData\" AS l INNER JOIN ( SELECT b.\"EquipmentId\", b.\"SubCategoryId\", e.\"MeterType\" FROM public.\"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN ( SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public.\"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\" = t0.\"SubCategoryId\" WHERE (l.\"CompanyId\" = 5) AND ((((date_trunc(\'day\', l.\"Date\") > (date_trunc(\'day\', now() AT TIME ZONE \'UTC\') + INTERVAL \'-30 days\')) AND (date_trunc(\'day\', l.\"Date\") <= date_trunc(\'day\', now() AT TIME ZONE \'UTC\'))) AND ((t0.\"SubCategoryCode\" = \'Mains\'))) AND (t.\"MeterType\" = 1)) ) AS t1 GROUP BY t1.\"Key\" LIMIT 2

ECActualPredYesterday=SELECT COALESCE(SUM(l.\"TotalKwH\"), 0.0)FROM public. \"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"CompanyId\", b.\"SubCategoryId\", e.\"MeterType\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public. \"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\" = t0.\"SubCategoryId\" WHERE (l.\"CompanyId\" = 5) AND ((((t.\"CompanyId\" = 5) AND (date_trunc(\'day\', l.\"Date\") = date_trunc(\'day\', now() AT TIME ZONE \'UTC\' + INTERVAL \'-1 days\'))) AND ((t0.\"SubCategoryCode\" = \'Mains\'))) AND (t.\"MeterType\" = 1))GROUP BY date_trunc(\'day\', now() AT TIME ZONE \'UTC\' + INTERVAL \'-1 days\')LIMIT 2
CostActualPredYesterday=SELECT COALESCE(SUM(l.\"Cost\"), 0.0) AS \"TotalCostUnit\" FROM public. \"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"CompanyId\", b.\"SubCategoryId\", e.\"MeterType\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public. \"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\" = t0.\"SubCategoryId\" WHERE (l.\"CompanyId\" = 5) AND ((((t.\"CompanyId\" = 5) AND (date_trunc(\'day\', l.\"Date\") = date_trunc(\'day\', now() AT TIME ZONE \'UTC\' + INTERVAL \'-1 days\'))) AND ((t0.\"SubCategoryCode\" = \'Mains\'))) AND (t.\"MeterType\" = 1))GROUP BY date_trunc(\'day\', now() AT TIME ZONE \'UTC\' + INTERVAL \'-1 days\')LIMIT 2
AvgKwhYesterday=SELECT COUNT(DISTINCT (CASE WHEN NOT (t1.\"IsHoliday\") THEN t1.\"Date\" END))::INT::double precision, COALESCE(SUM(t1.\"TotalKwH\"), 0.0)FROM (SELECT l.\"Date\", l.\"IsHoliday\", l.\"TotalKwH\", 1 AS \"Key\" FROM public. \"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"SubCategoryId\", e.\"MeterType\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public. \"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\" = t0.\"SubCategoryId\" WHERE (l.\"CompanyId\" = 5) AND ((((date_trunc(\'day\', l.\"Date\") > (date_trunc(\'day\', now() AT TIME ZONE \'UTC\') + INTERVAL \'-30 days\')) AND (date_trunc(\'day\', l.\"Date\") <= date_trunc(\'day\', now() AT TIME ZONE \'UTC\'))) AND ((t0.\"SubCategoryCode\" = \'Mains\'))) AND (t.\"MeterType\" = 1))) AS t1 GROUP BY t1.\"Key\" LIMIT 2


ECActualPredMonthly=SELECT COALESCE(SUM(l.\"TotalKwH\"), 0.0), COALESCE(SUM(l.\"TotalKwH\" / date_part(\'day\', now() AT TIME ZONE \'UTC\')::INT::double precision), 0.0), date_part(\'year\', now() AT TIME ZONE \'UTC\')::INT, date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT FROM public. \"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"CompanyId\", b.\"SubCategoryId\", e.\"MeterType\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public. \"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\" = t0.\"SubCategoryId\" WHERE (l.\"CompanyId\" = 5) AND ((((t.\"CompanyId\" = 5) AND (date_part(\'month\', l.\"Date\")::INT = date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT)) AND ((t0.\"SubCategoryCode\" = \'Mains\'))) AND (t.\"MeterType\" = 1))GROUP BY date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT LIMIT 2
CoAcMonthly=SELECT COALESCE(SUM(l.\"Cost\"), 0.0),COALESCE(SUM(l.\"Cost\"), 0.0) *30/ date_part(\'day\', now() AT TIME ZONE \'UTC\')::INT::numeric, date_part(\'year\', now() AT TIME ZONE \'UTC\')::INT, date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT FROM public. \"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"CompanyId\", b.\"SubCategoryId\", e.\"MeterType\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public.\"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\" = t0.\"SubCategoryId\" WHERE (l.\"CompanyId\" = 5) AND (((((t.\"CompanyId\" = 5) AND (date_part(\'month\', l.\"Date\")::INT = date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT)) AND NOT (l.\"IsHoliday\")) AND ((t0.\"SubCategoryCode\" = \'Mains\'))) AND (t.\"MeterType\" = 1))GROUP BY date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT LIMIT 2
Query=SELECT COALESCE(SUM(l.\"TotalKwH\"), 0.0), COALESCE(SUM(l.\"TotalKwH\" *30/ date_part(\'day\', now() AT TIME ZONE \'UTC\')::INT::double precision), 0.0), date_part(\'year\', now() AT TIME ZONE \'UTC\')::INT, date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT FROM public. \"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"CompanyId\", b.\"SubCategoryId\",e.\"MeterType\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public. \"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\" = t0.\"SubCategoryId\"WHERE (l.\"CompanyId\" = 5) AND ((((t.\"CompanyId\" = 5) AND (date_part(\'month\', l.\"Date\")::INT = date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT)) AND ((t0.\"SubCategoryCode\" = \'Mains\'))) AND (t.\"MeterType\" = 1))GROUP BY date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT LIMIT 2
ActualPF=SELECT CASE WHEN m.\"UPDATEDDATA\"->>\'Average_Power_Factor\' IS NULL THEN 0.0 ELSE CAST(m.\"UPDATEDDATA\"->>\'Average_Power_Factor\' AS double precision)END AS \"ActualPf\" FROM public.  \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" INNER JOIN \"MachineDataUpdate\" AS m ON b.\"EquipmentId\" = m.\"EquipmentId\" INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public.  \"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t ON b.\"SubCategoryId\" = t.\"SubCategoryId\" WHERE (b.\"CompanyId\" = 5) AND (((b.\"CompanyId\" = 5) AND (t.\"SubCategoryCode\" = \'Mains\')) AND b.\"Active\")
AvgKwhMonthly=SELECT COUNT(DISTINCT (CASE WHEN NOT (t1.\"IsHoliday\") THEN date_part(\'month\', t1.\"Date\")::INT END))::INT, COALESCE(SUM(t1.\"TotalKwH\"), 0.0) FROM (SELECT l.\"Date\", l.\"IsHoliday\", l.\"TotalKwH\", 1 AS \"Key\" FROM public. \"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"SubCategoryId\", e.\"MeterType\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5 ) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public. \"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\" = t0.\"SubCategoryId\" WHERE (l.\"CompanyId\" = 5) AND ((((date_trunc(\'day\', l.\"Date\") > current_date - INTERVAL \'12 months\') AND (l.\"Date\" <current_date - INTERVAL \'1 months\')) AND ((t0.\"SubCategoryCode\" = \'Mains\') ) AND (t.\"MeterType\" = 1)))) AS t1 GROUP BY t1.\"Key\" LIMIT 2

EnergyTreeToday=SELECT (SELECT t4."SubCategoryName" FROM "LenzDailyData" AS l1 INNER JOIN (SELECT b1."EquipmentId", b1."Active", b1."CompanyId", b1."Created", b1."CreatedBy", b1."Description", b1."DeviceId", b1."EquipmentCode", b1."Hierarchyid", b1."Label1", b1."Label2", b1."Label3", b1."Label4", b1."Label5", b1."LastModified", b1."LastModifiedBy", b1."Latitude", b1."Location", b1."Longitude", b1."ModelId", b1."SiteId", b1."SubCategoryId", e1."AmpereRating", e1."BaudRate", e1."BreakingCapacity", e1."Capacity", e1."CommandString", e1."HierarchyPath", e1."IsBBTempMonitored", e1."IsBSConnected", e1."IsGenset", e1."IsLMConnected", e1."IsVirtualMeter", e1."LenzEquipmentType", e1."LowLoadConsumption", e1."MeterNo", e1."MeterType", e1."ParentEquipmentHierarchyID", e1."Parity", e1."RatedLoading", e1."RatedPower", e1."SlaveID", e1."StopBit", e1."TankCapacity", e1."TankSize", e1."TypeOfBreaker" FROM "BaseEquipment" AS b1 INNER JOIN "EquipmentHierarchy" AS e1 ON b1."EquipmentId" = e1."EquipmentId" WHERE b1."CompanyId" = 5) AS t3 ON l1."EquipmentId" = t3."EquipmentId" INNER JOIN (SELECT s1."SubCategoryId", s1."CompanyId", s1."Created", s1."CreatedBy", s1."ImageUrl", s1."LastModified", s1."LastModifiedBy", s1."ProductCategoryID", s1."SubCategoryCode", s1."SubCategoryName" FROM "SubCategory" AS s1 WHERE s1."CompanyId" = 5 ) AS t4 ON t3."SubCategoryId" = t4."SubCategoryId" WHERE ((l1."CompanyId" = 5) AND (((((t3."CompanyId" = 5) AND (date_trunc('day', l1."Date") = date_trunc('day', now() AT TIME ZONE 'UTC'))) AND (t4."SubCategoryCode" = ANY (ARRAY['GreenEnergy', 'Mains', 'Backup']) OR (t4."SubCategoryCode" IS NULL AND array_position(ARRAY['GreenEnergy', 'Mains', 'Backup'], NULL) IS NOT NULL))) AND (t3."MeterType" = 1)) AND t3."Active")) AND (t."SubCategoryId" = t3."SubCategoryId") LIMIT 1) AS "SubCategory", round(COALESCE(SUM(l."TotalKwH"), 0.0)) AS "TotalKWH" FROM "LenzDailyData" AS l INNER JOIN ( SELECT b."EquipmentId", b."Active", b."CompanyId", b."SubCategoryId", e."MeterType" FROM "BaseEquipment" AS b INNER JOIN "EquipmentHierarchy" AS e ON b."EquipmentId" = e."EquipmentId" WHERE b."CompanyId" = 5 ) AS t ON l."EquipmentId" = t."EquipmentId" INNER JOIN ( SELECT s."SubCategoryId", s."SubCategoryCode" FROM "SubCategory" AS s WHERE s."CompanyId" = 5 ) AS t0 ON t."SubCategoryId" = t0."SubCategoryId" WHERE (l."CompanyId" = 5) AND (((((t."CompanyId" = 5) AND (date_trunc('day', l."Date") = date_trunc('day', now() AT TIME ZONE 'UTC'))) AND (t0."SubCategoryCode" = ANY (ARRAY['GreenEnergy', 'Mains', 'Backup']) OR (t0."SubCategoryCode" IS NULL AND array_position(ARRAY['GreenEnergy', 'Mains', 'Backup'], NULL) IS NOT NULL))) AND (t."MeterType" = 1)) AND t."Active") GROUP BY t."SubCategoryId" ORDER BY (  SELECT t4."SubCategoryName"  FROM "LenzDailyData" AS l1 INNER JOIN ( SELECT b1."EquipmentId", b1."Active", b1."CompanyId", b1."Created", b1."CreatedBy", b1."Description", b1."DeviceId", b1."EquipmentCode", b1."Hierarchyid", b1."Label1", b1."Label2", b1."Label3", b1."Label4", b1."Label5", b1."LastModified", b1."LastModifiedBy", b1."Latitude", b1."Location", b1."Longitude", b1."ModelId", b1."SiteId", b1."SubCategoryId", e1."AmpereRating", e1."BaudRate", e1."BreakingCapacity", e1."Capacity", e1."CommandString", e1."HierarchyPath", e1."IsBBTempMonitored", e1."IsBSConnected", e1."IsGenset", e1."IsLMConnected", e1."IsVirtualMeter", e1."LenzEquipmentType", e1."LowLoadConsumption", e1."MeterNo", e1."MeterType", e1."ParentEquipmentHierarchyID", e1."Parity", e1."RatedLoading", e1."RatedPower", e1."SlaveID", e1."StopBit", e1."TankCapacity", e1."TankSize", e1."TypeOfBreaker"  FROM "BaseEquipment" AS b1  INNER JOIN "EquipmentHierarchy" AS e1 ON b1."EquipmentId" = e1."EquipmentId"  WHERE b1."CompanyId" = 5 ) AS t3 ON l1."EquipmentId" = t3."EquipmentId" INNER JOIN ( SELECT s1."SubCategoryId", s1."CompanyId", s1."Created", s1."CreatedBy", s1."ImageUrl", s1."LastModified", s1."LastModifiedBy", s1."ProductCategoryID", s1."SubCategoryCode", s1."SubCategoryName" FROM "SubCategory" AS s1 WHERE s1."CompanyId" = 5 ) AS t4 ON t3."SubCategoryId" = t4."SubCategoryId" WHERE ((l1."CompanyId" = 5) AND (((((t3."CompanyId" = 5) AND (date_trunc('day', l1."Date") = date_trunc('day', now() AT TIME ZONE 'UTC'))) AND (t4."SubCategoryCode" = ANY (ARRAY['GreenEnergy', 'Mains', 'Backup']) OR (t4."SubCategoryCode" IS NULL AND array_position(ARRAY['GreenEnergy', 'Mains', 'Backup'], NULL) IS NOT NULL))) AND (t3."MeterType" = 1)) AND t3."Active")) AND (t."SubCategoryId" = t3."SubCategoryId") LIMIT 1)
EnergyTreeYesterday=SELECT (SELECT t4."SubCategoryName" FROM "LenzDailyData" AS l1 INNER JOIN ( SELECT b1."EquipmentId", b1."Active", b1."CompanyId", b1."Created", b1."CreatedBy", b1."Description", b1."DeviceId", b1."EquipmentCode", b1."Hierarchyid", b1."Label1", b1."Label2", b1."Label3", b1."Label4", b1."Label5", b1."LastModified", b1."LastModifiedBy", b1."Latitude", b1."Location", b1."Longitude", b1."ModelId", b1."SiteId", b1."SubCategoryId", e1."AmpereRating", e1."BaudRate", e1."BreakingCapacity", e1."Capacity", e1."CommandString", e1."HierarchyPath", e1."IsBBTempMonitored", e1."IsBSConnected", e1."IsCalculation", e1."IsGenset", e1."IsLMConnected", e1."IsVirtualMeter", e1."LenzEquipmentType", e1."LowLoadConsumption", e1."MeterNo", e1."MeterType", e1."ParentEquipmentHierarchyID", e1."Parity", e1."RatedLoading", e1."RatedPower", e1."SlaveID", e1."StopBit", e1."TankCapacity", e1."TankSize", e1."TypeOfBreaker" FROM "BaseEquipment" AS b1 INNER JOIN "EquipmentHierarchy" AS e1 ON b1."EquipmentId" = e1."EquipmentId" WHERE b1."CompanyId" = 5 ) AS t3 ON l1."EquipmentId" = t3."EquipmentId" INNER JOIN ( SELECT s1."SubCategoryId", s1."CompanyId", s1."Created", s1."CreatedBy", s1."ImageUrl", s1."LastModified", s1."LastModifiedBy", s1."ProductCategoryID", s1."SubCategoryCode", s1."SubCategoryName" FROM "SubCategory" AS s1 WHERE s1."CompanyId" = 5 ) AS t4 ON t3."SubCategoryId" = t4."SubCategoryId" WHERE ((l1."CompanyId" = 5) AND ((((t3."CompanyId" =5) AND (date_trunc('day', l1."Date") = date_trunc('day', now() AT TIME ZONE 'UTC' + INTERVAL '-1 days'))) AND (t4."SubCategoryCode" = ANY ((ARRAY['GreenEnergy', 'Mains', 'Backup']) ) OR (t4."SubCategoryCode" IS NULL AND array_position((ARRAY['GreenEnergy', 'Mains', 'Backup']) , NULL) IS NOT NULL))) AND (t3."MeterType" = 1))) AND (((date_trunc('day', now() AT TIME ZONE 'UTC' + INTERVAL '-1 days') = date_trunc('day', now() AT TIME ZONE 'UTC' + INTERVAL '-1 days')) OR ((now() AT TIME ZONE 'UTC' IS NULL OR INTERVAL '-1 days' IS NULL) AND (now() AT TIME ZONE 'UTC' IS NULL OR INTERVAL '-1 days' IS NULL))) AND (t."SubCategoryId" = t3."SubCategoryId")) LIMIT 1), COALESCE(SUM(l."TotalKwH"), 0.0) FROM "LenzDailyData" AS l INNER JOIN ( SELECT b."EquipmentId", b."CompanyId", b."SubCategoryId", e."MeterType" FROM "BaseEquipment" AS b INNER JOIN "EquipmentHierarchy" AS e ON b."EquipmentId" = e."EquipmentId"  WHERE b."CompanyId" = 5) AS t ON l."EquipmentId" = t."EquipmentId" INNER JOIN ( SELECT s."SubCategoryId", s."SubCategoryCode" FROM "SubCategory" AS s WHERE s."CompanyId" = 5) AS t0 ON t."SubCategoryId" = t0."SubCategoryId" WHERE (l."CompanyId" = 5) AND ((((t."CompanyId" = 5) AND (date_trunc('day', l."Date") = date_trunc('day', now() AT TIME ZONE 'UTC' + INTERVAL '-1 days'))) AND (t0."SubCategoryCode" = ANY ((ARRAY['GreenEnergy', 'Mains', 'Backup']) ) OR (t0."SubCategoryCode" IS NULL AND array_position((ARRAY['GreenEnergy', 'Mains', 'Backup']) , NULL) IS NOT NULL))) AND (t."MeterType" = 1)) GROUP BY date_trunc('day', now() AT TIME ZONE 'UTC' + INTERVAL '-1 days'), t."SubCategoryId" ORDER BY ( SELECT t4."SubCategoryName" FROM "LenzDailyData" AS l1 INNER JOIN (  SELECT b1."EquipmentId", b1."Active", b1."CompanyId", b1."Created", b1."CreatedBy", b1."Description", b1."DeviceId", b1."EquipmentCode", b1."Hierarchyid", b1."Label1", b1."Label2", b1."Label3", b1."Label4", b1."Label5", b1."LastModified", b1."LastModifiedBy", b1."Latitude", b1."Location", b1."Longitude", b1."ModelId", b1."SiteId", b1."SubCategoryId", e1."AmpereRating", e1."BaudRate", e1."BreakingCapacity", e1."Capacity", e1."CommandString", e1."HierarchyPath", e1."IsBBTempMonitored", e1."IsBSConnected", e1."IsCalculation", e1."IsGenset", e1."IsLMConnected", e1."IsVirtualMeter", e1."LenzEquipmentType", e1."LowLoadConsumption", e1."MeterNo", e1."MeterType", e1."ParentEquipmentHierarchyID", e1."Parity", e1."RatedLoading", e1."RatedPower", e1."SlaveID", e1."StopBit", e1."TankCapacity", e1."TankSize", e1."TypeOfBreaker" FROM "BaseEquipment" AS b1 INNER JOIN "EquipmentHierarchy" AS e1 ON b1."EquipmentId" = e1."EquipmentId"  WHERE b1."CompanyId" = 5 ) AS t3 ON l1."EquipmentId" = t3."EquipmentId" INNER JOIN ( SELECT s1."SubCategoryId", s1."CompanyId", s1."Created", s1."CreatedBy", s1."ImageUrl", s1."LastModified", s1."LastModifiedBy", s1."ProductCategoryID", s1."SubCategoryCode", s1."SubCategoryName" FROM "SubCategory" AS s1 WHERE s1."CompanyId" = 5  ) AS t4 ON t3."SubCategoryId" = t4."SubCategoryId" WHERE ((l1."CompanyId" = 5) AND ((((t3."CompanyId" = 5) AND (date_trunc('day', l1."Date") = date_trunc('day', now() AT TIME ZONE 'UTC' + INTERVAL '-1 days'))) AND (t4."SubCategoryCode" = ANY ((ARRAY['GreenEnergy', 'Mains', 'Backup']) ) OR (t4."SubCategoryCode" IS NULL AND array_position((ARRAY['GreenEnergy', 'Mains', 'Backup']) , NULL) IS NOT NULL))) AND (t3."MeterType" = 1))) AND (((date_trunc('day', now() AT TIME ZONE 'UTC' + INTERVAL '-1 days') = date_trunc('day', now() AT TIME ZONE 'UTC' + INTERVAL '-1 days')) OR ((now() AT TIME ZONE 'UTC' IS NULL OR INTERVAL '-1 days' IS NULL) AND (now() AT TIME ZONE 'UTC' IS NULL OR INTERVAL '-1 days' IS NULL))) AND (t."SubCategoryId" = t3."SubCategoryId")) LIMIT 1)
EnergyTreeMonth=SELECT ( SELECT t4."SubCategoryName" FROM "LenzDailyData" AS l1 INNER JOIN ( SELECT b1."EquipmentId", b1."Active", b1."CompanyId", b1."Created", b1."CreatedBy", b1."Description", b1."DeviceId", b1."EquipmentCode", b1."Hierarchyid", b1."Label1", b1."Label2", b1."Label3", b1."Label4", b1."Label5", b1."LastModified", b1."LastModifiedBy", b1."Latitude", b1."Location", b1."Longitude", b1."ModelId", b1."SiteId", b1."SubCategoryId", e1."AmpereRating", e1."BaudRate", e1."BreakingCapacity", e1."Capacity", e1."CommandString", e1."HierarchyPath", e1."IsBBTempMonitored", e1."IsBSConnected", e1."IsCalculation", e1."IsGenset", e1."IsLMConnected", e1."IsVirtualMeter", e1."LenzEquipmentType", e1."LowLoadConsumption", e1."MeterNo", e1."MeterType", e1."ParentEquipmentHierarchyID", e1."Parity", e1."RatedLoading", e1."RatedPower", e1."SlaveID", e1."StopBit", e1."TankCapacity", e1."TankSize", e1."TypeOfBreaker" FROM "BaseEquipment" AS b1 INNER JOIN "EquipmentHierarchy" AS e1 ON b1."EquipmentId" = e1."EquipmentId" WHERE b1."CompanyId" = 5 ) AS t3 ON l1."EquipmentId" = t3."EquipmentId" INNER JOIN (  SELECT s1."SubCategoryId", s1."CompanyId", s1."Created", s1."CreatedBy", s1."ImageUrl", s1."LastModified", s1."LastModifiedBy", s1."ProductCategoryID", s1."SubCategoryCode", s1."SubCategoryName" FROM "SubCategory" AS s1 WHERE s1."CompanyId" = 5 ) AS t4 ON t3."SubCategoryId" = t4."SubCategoryId" WHERE ((l1."CompanyId" = 5) AND (((((t3."CompanyId" = 5) AND (date_part('month', l1."Date")::INT = date_part('month', now() AT TIME ZONE 'UTC')::INT)) AND (date_part('year', l1."Date")::INT = date_part('year', now() AT TIME ZONE 'UTC')::INT)) AND (t4."SubCategoryCode" = ANY ((ARRAY['GreenEnergy', 'Mains', 'Backup']) ) OR (t4."SubCategoryCode" IS NULL AND array_position((ARRAY['GreenEnergy', 'Mains', 'Backup']) , NULL) IS NOT NULL))) AND (t3."MeterType" = 1))) AND (((date_part('month', now() AT TIME ZONE 'UTC')::INT = date_part('month', now() AT TIME ZONE 'UTC')::INT) OR now() AT TIME ZONE 'UTC' IS NULL) AND (t."SubCategoryId" = t3."SubCategoryId")) LIMIT 1), COALESCE(SUM(l."TotalKwH"), 0.0) FROM "LenzDailyData" AS l INNER JOIN ( SELECT b."EquipmentId", b."CompanyId", b."SubCategoryId", e."MeterType" FROM "BaseEquipment" AS b INNER JOIN "EquipmentHierarchy" AS e ON b."EquipmentId" = e."EquipmentId" WHERE b."CompanyId" =5) AS t ON l."EquipmentId" = t."EquipmentId" INNER JOIN ( SELECT s."SubCategoryId", s."SubCategoryCode" FROM "SubCategory" AS s WHERE s."CompanyId" = 5) AS t0 ON t."SubCategoryId" = t0."SubCategoryId" WHERE (l."CompanyId" = 5) AND (((((t."CompanyId" =5) AND (date_part('month', l."Date")::INT = date_part('month', now() AT TIME ZONE 'UTC')::INT)) AND (date_part('year', l."Date")::INT = date_part('year', now() AT TIME ZONE 'UTC')::INT)) AND (t0."SubCategoryCode" = ANY ((ARRAY['GreenEnergy', 'Mains', 'Backup']) ) OR (t0."SubCategoryCode" IS NULL AND array_position((ARRAY['GreenEnergy', 'Mains', 'Backup']) , NULL) IS NOT NULL))) AND (t."MeterType" = 1)) GROUP BY date_part('month', now() AT TIME ZONE 'UTC')::INT, t."SubCategoryId" ORDER BY ( SELECT t4."SubCategoryName"  FROM "LenzDailyData" AS l1 INNER JOIN (  SELECT b1."EquipmentId", b1."Active", b1."CompanyId", b1."Created", b1."CreatedBy", b1."Description", b1."DeviceId", b1."EquipmentCode", b1."Hierarchyid", b1."Label1", b1."Label2", b1."Label3", b1."Label4", b1."Label5", b1."LastModified", b1."LastModifiedBy", b1."Latitude", b1."Location", b1."Longitude", b1."ModelId", b1."SiteId", b1."SubCategoryId", e1."AmpereRating", e1."BaudRate", e1."BreakingCapacity", e1."Capacity", e1."CommandString", e1."HierarchyPath", e1."IsBBTempMonitored", e1."IsBSConnected", e1."IsCalculation", e1."IsGenset", e1."IsLMConnected", e1."IsVirtualMeter", e1."LenzEquipmentType", e1."LowLoadConsumption", e1."MeterNo", e1."MeterType", e1."ParentEquipmentHierarchyID", e1."Parity", e1."RatedLoading", e1."RatedPower", e1."SlaveID", e1."StopBit", e1."TankCapacity", e1."TankSize", e1."TypeOfBreaker" FROM "BaseEquipment" AS b1  INNER JOIN "EquipmentHierarchy" AS e1 ON b1."EquipmentId" = e1."EquipmentId" WHERE b1."CompanyId" =5 ) AS t3 ON l1."EquipmentId" = t3."EquipmentId" INNER JOIN ( SELECT s1."SubCategoryId", s1."CompanyId", s1."Created", s1."CreatedBy", s1."ImageUrl", s1."LastModified", s1."LastModifiedBy", s1."ProductCategoryID", s1."SubCategoryCode", s1."SubCategoryName" FROM "SubCategory" AS s1  WHERE s1."CompanyId" =5 ) AS t4 ON t3."SubCategoryId" = t4."SubCategoryId" WHERE ((l1."CompanyId" = 5) AND (((((t3."CompanyId" = 5) AND (date_part('month', l1."Date")::INT = date_part('month', now() AT TIME ZONE 'UTC')::INT)) AND (date_part('year', l1."Date")::INT = date_part('year', now() AT TIME ZONE 'UTC')::INT)) AND (t4."SubCategoryCode" = ANY ((ARRAY['GreenEnergy', 'Mains', 'Backup']) ) OR (t4."SubCategoryCode" IS NULL AND array_position((ARRAY['GreenEnergy', 'Mains', 'Backup']) , NULL) IS NOT NULL))) AND (t3."MeterType" = 1))) AND (((date_part('month', now() AT TIME ZONE 'UTC')::INT = date_part('month', now() AT TIME ZONE 'UTC')::INT) OR now() AT TIME ZONE 'UTC' IS NULL) AND (t."SubCategoryId" = t3."SubCategoryId")) LIMIT 1)


EnergyConsumptionTrend=SELECT COALESCE(( SELECT l1."Date" FROM "LenzHourlyData" AS l1 INNER JOIN ( SELECT b1."EquipmentId", b1."Active", b1."CompanyId", b1."Created", b1."CreatedBy", b1."Description", b1."DeviceId", b1."EquipmentCode", b1."Hierarchyid", b1."Label1", b1."Label2", b1."Label3", b1."Label4", b1."Label5", b1."LastModified", b1."LastModifiedBy", b1."Latitude", b1."Location", b1."Longitude", b1."ModelId", b1."SiteId", b1."SubCategoryId", e1."AmpereRating", e1."BaudRate", e1."BreakingCapacity", e1."Capacity", e1."CommandString", e1."HierarchyPath", e1."IsBBTempMonitored", e1."IsBSConnected", e1."IsGenset", e1."IsLMConnected", e1."IsVirtualMeter", e1."LenzEquipmentType", e1."LowLoadConsumption", e1."MeterNo", e1."MeterType", e1."ParentEquipmentHierarchyID", e1."Parity", e1."RatedLoading", e1."RatedPower", e1."SlaveID", e1."StopBit", e1."TankCapacity", e1."TankSize", e1."TypeOfBreaker" FROM "BaseEquipment" AS b1  INNER JOIN "EquipmentHierarchy" AS e1 ON b1."EquipmentId" = e1."EquipmentId" WHERE b1."CompanyId" = 5 ) AS t3 ON l1."EquipmentId" = t3."EquipmentId" INNER JOIN ( SELECT s1."SubCategoryId", s1."CompanyId", s1."Created", s1."CreatedBy", s1."ImageUrl", s1."LastModified", s1."LastModifiedBy", s1."ProductCategoryID", s1."SubCategoryCode", s1."SubCategoryName" FROM "SubCategory" AS s1 WHERE s1."CompanyId" = 5 ) AS t4 ON t3."SubCategoryId" = t4."SubCategoryId" WHERE ((l1."CompanyId" = 5) AND ((((t3."CompanyId" = 5) AND ((t4."SubCategoryCode" = 'Mains'))) AND (l1."Date" > now() at time zone 'utc' - INTERVAL '5 days')) AND (t3."MeterType" = 1))) AND (l."Date" = l1."Date") LIMIT 1), TIMESTAMP '-infinity'), COALESCE(SUM(l."TotalKwH"), 0.0) FROM "LenzHourlyData" AS l INNER JOIN ( SELECT b."EquipmentId", b."CompanyId", b."SubCategoryId", e."MeterType" FROM "BaseEquipment" AS b INNER JOIN "EquipmentHierarchy" AS e ON b."EquipmentId" = e."EquipmentId" WHERE b."CompanyId" = 5 ) AS t ON l."EquipmentId" = t."EquipmentId" INNER JOIN ( SELECT s."SubCategoryId", s."SubCategoryCode" FROM "SubCategory" AS s WHERE s."CompanyId" = 5 ) AS t0 ON t."SubCategoryId" = t0."SubCategoryId" WHERE (l."CompanyId" = 5) AND ((((t."CompanyId" = 5) AND ((t0."SubCategoryCode" = 'Mains'))) AND (l."Date" > now() at time zone 'utc' - INTERVAL '5 days')) AND (t."MeterType" = 1)) GROUP BY l."Date" ORDER BY COALESCE(( SELECT l1."Date" FROM "LenzHourlyData" AS l1 INNER JOIN ( SELECT b1."EquipmentId", b1."Active", b1."CompanyId", b1."Created", b1."CreatedBy", b1."Description", b1."DeviceId", b1."EquipmentCode", b1."Hierarchyid", b1."Label1", b1."Label2", b1."Label3", b1."Label4", b1."Label5", b1."LastModified", b1."LastModifiedBy", b1."Latitude", b1."Location", b1."Longitude", b1."ModelId", b1."SiteId", b1."SubCategoryId", e1."AmpereRating", e1."BaudRate", e1."BreakingCapacity", e1."Capacity", e1."CommandString", e1."HierarchyPath", e1."IsBBTempMonitored", e1."IsBSConnected", e1."IsGenset", e1."IsLMConnected", e1."IsVirtualMeter", e1."LenzEquipmentType", e1."LowLoadConsumption", e1."MeterNo", e1."MeterType", e1."ParentEquipmentHierarchyID", e1."Parity", e1."RatedLoading", e1."RatedPower", e1."SlaveID", e1."StopBit", e1."TankCapacity", e1."TankSize", e1."TypeOfBreaker"  FROM "BaseEquipment" AS b1 INNER JOIN "EquipmentHierarchy" AS e1 ON b1."EquipmentId" = e1."EquipmentId"  WHERE b1."CompanyId" = 5 ) AS t3 ON l1."EquipmentId" = t3."EquipmentId" INNER JOIN ( SELECT s1."SubCategoryId", s1."CompanyId", s1."Created", s1."CreatedBy", s1."ImageUrl", s1."LastModified", s1."LastModifiedBy", s1."ProductCategoryID", s1."SubCategoryCode", s1."SubCategoryName"  FROM "SubCategory" AS s1 WHERE s1."CompanyId" = 5 ) AS t4 ON t3."SubCategoryId" = t4."SubCategoryId" WHERE ((l1."CompanyId" = 5) AND ((((t3."CompanyId" = 5) AND ((t4."SubCategoryCode" = 'Mains'))) AND (l1."Date" > now() at time zone 'utc' - INTERVAL '5 days')) AND (t3."MeterType" = 1))) AND (l."Date" = l1."Date") LIMIT 1), TIMESTAMP '-infinity')


EnergyUsageDaywise=SELECT date_trunc(\'day\', l.\"Date\"), COALESCE(SUM(CASE WHEN m.\"IsShowOnDashboard\" AND (p.\"ParameterName\" = \'kWH\') THEN l.\"TotalKwH\" END), 0.0) > 0.0, COALESCE(SUM(CASE WHEN m.\"IsShowOnDashboard\" AND (p.\"ParameterName\" = \'kWH\') THEN l.\"TotalKwH\" END), 0.0), COALESCE(SUM(CASE WHEN m.\"IsShowOnDashboard\" AND (p.\"ParameterName\" = \'kVAH\') THEN l.\"TotalkVAh\" END), 0.0) > 0.0, COALESCE(SUM(CASE WHEN m.\"IsShowOnDashboard\" AND (p.\"ParameterName\" = \'kVAH\') THEN l.\"TotalkVAh\" END), 0.0)FROM public. \"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"Active\", b.\"CompanyId\", b.\"ModelId\", b.\"SubCategoryId\", e.\"MeterType\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\"INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public. \"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\" = t0.\"SubCategoryId\" INNER JOIN \"ModelParameter\" AS m ON t.\"ModelId\" = m.\"ModelId\" INNER JOIN \"Parameter\" AS p ON m.\"ParameterId\" = p.\"ParameterId\" WHERE (l.\"CompanyId\" = 5) AND (((((t.\"CompanyId\" = 5) AND (date_trunc (\'day\', l.\"Date\") > (current_date - INTEGER \'6\') - INTERVAL \'24 hours\')) AND ((t0.\"SubCategoryCode\" = \'Mains\'))) AND (t.\"MeterType\" = 1)) AND t.\"Active\")GROUP BY date_trunc (\'day\', l.\"Date\")ORDER BY date_trunc ASC;
EnergyUsageMonthwise=SELECT t1.c, t1.c0, t1.c1, t2.\"Date\", t2.c FROM (SELECT date_part(\'month\', l.\"Date\")::INT AS c, date_part(\'year\', l.\"Date\")::INT AS c0, round(COALESCE(SUM(l.\"TotalKwH\"), 0.0)) AS c1 FROM public. \"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"Active\", b.\"CompanyId\", b.\"SubCategoryId\", e.\"MeterType\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5 ) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public. \"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\" = t0.\"SubCategoryId\" WHERE (l.\"CompanyId\" = 5) AND ((((t.\"CompanyId\" = 5) AND ((t0.\"SubCategoryCode\" = \'Mains\') )) AND (t.\"MeterType\" = 1)) AND t.\"Active\")GROUP BY date_part(\'month\', l.\"Date\")::INT, date_part(\'year\', l.\"Date\")::INT) AS t1 LEFT JOIN LATERAL (SELECT l0.\"Date\", 1 AS c FROM public. \"LenzDailyData\" AS l0 INNER JOIN (SELECT b0.\"EquipmentId\", b0.\"Active\", b0.\"CompanyId\", b0.\"SubCategoryId\", e0.\"IsCalculation\", e0.\"MeterType\" FROM public. \"BaseEquipment\" AS b0 INNER JOIN \"EquipmentHierarchy\" AS e0 ON b0.\"EquipmentId\" = e0.\"EquipmentId\" WHERE b0.\"CompanyId\" = 5) AS t3 ON l0.\"EquipmentId\" = t3.\"EquipmentId\" INNER JOIN (SELECT s0.\"SubCategoryId\", s0.\"SubCategoryCode\" FROM public. \"SubCategory\" AS s0 WHERE s0.\"CompanyId\" = 5) AS t4 ON t3.\"SubCategoryId\" = t4.\"SubCategoryId\" WHERE((l0.\"CompanyId\" = 5) AND ((((t3.\"CompanyId\" = 5) AND ((t4.\"SubCategoryCode\" = \'Mains\') )) AND (t3.\"MeterType\" = 1)) AND t3.\"Active\")) AND ((t1.c = date_part(\'month\', l0.\"Date\")::INT) AND (t1.c0 = date_part(\'year\', l0.\"Date\")::INT))LIMIT 1) AS t2 ON TRUE ORDER BY t1.c0, t1.c
EnergyUsageDivisionwise=SELECT COALESCE((SELECT t4.\"DivisionID\" FROM public. \"LenzDailyData\" AS l1 INNER JOIN (SELECT b1.\"EquipmentId\", b1.\"Active\", b1.\"CompanyId\", b1.\"Created\", b1.\"CreatedBy\", b1.\"Description\", b1.\"DeviceId\", b1.\"EquipmentCode\", b1.\"Hierarchyid\", b1.\"Label1\", b1.\"Label2\", b1.\"Label3\", b1.\"Label4\", b1.\"Label5\", b1.\"LastModified\", b1.\"LastModifiedBy\", b1.\"Latitude\", b1.\"Location\", b1.\"Longitude\", b1.\"ModelId\", b1.\"SiteId\", b1.\"SubCategoryId\", e1.\"AmpereRating\", e1.\"BaudRate\", e1.\"BreakingCapacity\", e1.\"Capacity\", e1.\"CommandString\", e1.\"HierarchyPath\", e1.\"IsBBTempMonitored\", e1.\"IsBSConnected\", e1.\"IsGenset\", e1.\"IsLMConnected\", e1.\"IsVirtualMeter\", e1.\"LenzEquipmentType\", e1.\"LowLoadConsumption\", e1.\"MeterNo\", e1.\"MeterType\", e1.\"ParentEquipmentHierarchyID\", e1.\"Parity\", e1.\"RatedLoading\", e1.\"RatedPower\", e1.\"SlaveID\", e1.\"StopBit\", e1.\"TankCapacity\", e1.\"TankSize\", e1.\"TypeOfBreaker\" FROM public. \"BaseEquipment\" AS b1 INNER JOIN \"EquipmentHierarchy\" AS e1 ON b1.\"EquipmentId\" = e1.\"EquipmentId\" WHERE b1.\"CompanyId\" = 5) AS t3 ON l1.\"EquipmentId\" = t3.\"EquipmentId\" INNER JOIN \"DivisionMap\" AS d3 ON l1.\"EquipmentId\" = d3.\"EquipmentId\" INNER JOIN (SELECT d4.\"DivisionID\", d4.\"CompanyId\", d4.\"Created\", d4.\"CreatedBy\", d4.\"DivisionCode\", d4.\"DivisionName\", d4.\"IsActive\", d4.\"IsShow\", d4.\"LastModified\", d4.\"LastModifiedBy\" FROM public. \"Division\" AS d4 WHERE d4.\"CompanyId\" = 5) AS t4 ON d3.\"DivisionID\" = t4.\"DivisionID\" WHERE ((l1.\"CompanyId\" = 5) AND (((((t3.\"CompanyId\" = 5) AND t4.\"IsActive\") AND ((date_part(\'month\', l1.\"Date\")::INT = date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT) AND (date_part(\'year\', l1.\"Date\")::INT = date_part(\'year\', now() AT TIME ZONE \'UTC\')::INT))) AND (t3.\"MeterType\" = 1)) AND t3.\"Active\")) AND (t0.\"DivisionID\" = t4.\"DivisionID\") LIMIT 1), 0) AS \"DivisionId\", ( SELECT t6.\"DivisionName\" FROM public. \"LenzDailyData\" AS l2 INNER JOIN (SELECT b2.\"EquipmentId\", b2.\"Active\", b2.\"CompanyId\", b2.\"Created\", b2.\"CreatedBy\", b2.\"Description\", b2.\"DeviceId\", b2.\"EquipmentCode\", b2.\"Hierarchyid\", b2.\"Label1\", b2.\"Label2\", b2.\"Label3\", b2.\"Label4\", b2.\"Label5\", b2.\"LastModified\", b2.\"LastModifiedBy\", b2.\"Latitude\", b2.\"Location\", b2.\"Longitude\", b2.\"ModelId\", b2.\"SiteId\", b2.\"SubCategoryId\", e2.\"AmpereRating\", e2.\"BaudRate\", e2.\"BreakingCapacity\", e2.\"Capacity\", e2.\"CommandString\", e2.\"HierarchyPath\", e2.\"IsBBTempMonitored\", e2.\"IsBSConnected\", e2.\"IsGenset\", e2.\"IsLMConnected\", e2.\"IsVirtualMeter\", e2.\"LenzEquipmentType\", e2.\"LowLoadConsumption\", e2.\"MeterNo\", e2.\"MeterType\", e2.\"ParentEquipmentHierarchyID\", e2.\"Parity\", e2.\"RatedLoading\", e2.\"RatedPower\", e2.\"SlaveID\", e2.\"StopBit\", e2.\"TankCapacity\", e2.\"TankSize\", e2.\"TypeOfBreaker\" FROM public. \"BaseEquipment\" AS b2 INNER JOIN \"EquipmentHierarchy\" AS e2 ON b2.\"EquipmentId\" = e2.\"EquipmentId\" WHERE b2.\"CompanyId\" = 5) AS t5 ON l2.\"EquipmentId\" = t5.\"EquipmentId\" INNER JOIN \"DivisionMap\" AS d5 ON l2.\"EquipmentId\" = d5.\"EquipmentId\" INNER JOIN (SELECT d6.\"DivisionID\", d6.\"CompanyId\", d6.\"Created\", d6.\"CreatedBy\", d6.\"DivisionCode\", d6.\"DivisionName\", d6.\"IsActive\", d6.\"IsShow\", d6.\"LastModified\", d6.\"LastModifiedBy\" FROM public. \"Division\" AS d6 WHERE d6.\"CompanyId\" = 5) AS t6 ON d5.\"DivisionID\" = t6.\"DivisionID\" WHERE ((l2.\"CompanyId\" = 5) AND (((((t5.\"CompanyId\" = 5) AND t6.\"IsActive\") AND ((date_part(\'month\', l2.\"Date\")::INT = date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT) AND (date_part(\'year\', l2.\"Date\")::INT = date_part(\'year\', now() AT TIME ZONE \'UTC\')::INT))) AND (t5.\"MeterType\" = 1)) AND t5.\"Active\")) AND (t0.\"DivisionID\" = t6.\"DivisionID\") LIMIT 1) AS \"DivisionName\", true AS \"PFFlagkWh\", round(COALESCE(SUM(l.\"TotalKwH\"), 0.0)) AS \"PFKwH\" FROM public. \"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"Active\", b.\"CompanyId\", e.\"MeterType\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN \"DivisionMap\" AS d ON l.\"EquipmentId\" = d.\"EquipmentId\" INNER JOIN (SELECT d0.\"DivisionID\", d0.\"IsActive\" FROM public. \"Division\" AS d0 WHERE d0.\"CompanyId\" = 5) AS t0 ON d.\"DivisionID\" = t0.\"DivisionID\" WHERE (l.\"CompanyId\" = 5) AND (((((t.\"CompanyId\" = 5) AND t0.\"IsActive\") AND ((date_part(\'month\', l.\"Date\")::INT = date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT) AND (date_part(\'year\', l.\"Date\")::INT = date_part(\'year\', now() AT TIME ZONE \'UTC\')::INT))) AND (t.\"MeterType\" = 1)) AND t.\"Active\")GROUP BY t0.\"DivisionID\" ORDER BY (SELECT t6.\"DivisionName\" FROM public. \"LenzDailyData\" AS l2 INNER JOIN (SELECT b2.\"EquipmentId\", b2.\"Active\", b2.\"CompanyId\", b2.\"Created\", b2.\"CreatedBy\", b2.\"Description\", b2.\"DeviceId\", b2.\"EquipmentCode\", b2.\"Hierarchyid\", b2.\"Label1\", b2.\"Label2\", b2.\"Label3\", b2.\"Label4\", b2.\"Label5\", b2.\"LastModified\", b2.\"LastModifiedBy\", b2.\"Latitude\", b2.\"Location\", b2.\"Longitude\", b2.\"ModelId\", b2.\"SiteId\", b2.\"SubCategoryId\", e2.\"AmpereRating\", e2.\"BaudRate\", e2.\"BreakingCapacity\", e2.\"Capacity\", e2.\"CommandString\", e2.\"HierarchyPath\", e2.\"IsBBTempMonitored\", e2.\"IsBSConnected\", e2.\"IsGenset\", e2.\"IsLMConnected\", e2.\"IsVirtualMeter\", e2.\"LenzEquipmentType\", e2.\"LowLoadConsumption\", e2.\"MeterNo\", e2.\"MeterType\", e2.\"ParentEquipmentHierarchyID\", e2.\"Parity\", e2.\"RatedLoading\", e2.\"RatedPower\", e2.\"SlaveID\", e2.\"StopBit\", e2.\"TankCapacity\", e2.\"TankSize\", e2.\"TypeOfBreaker\" FROM public. \"BaseEquipment\" AS b2 INNER JOIN \"EquipmentHierarchy\" AS e2 ON b2.\"EquipmentId\" = e2.\"EquipmentId\" WHERE b2.\"CompanyId\" = 5) AS t5 ON l2.\"EquipmentId\" = t5.\"EquipmentId\" INNER JOIN \"DivisionMap\" AS d5 ON l2.\"EquipmentId\" = d5.\"EquipmentId\" INNER JOIN (SELECT d6.\"DivisionID\", d6.\"CompanyId\", d6.\"Created\", d6.\"CreatedBy\", d6.\"DivisionCode\", d6.\"DivisionName\", d6.\"IsActive\", d6.\"IsShow\", d6.\"LastModified\", d6.\"LastModifiedBy\" FROM public. \"Division\" AS d6 WHERE d6.\"CompanyId\" = 5) AS t6 ON d5.\"DivisionID\" = t6.\"DivisionID\" WHERE ((l2.\"CompanyId\" = 5) AND (((((t5.\"CompanyId\" = 5) AND t6.\"IsActive\") AND ((date_part(\'month\', l2.\"Date\")::INT = date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT) AND (date_part(\'year\', l2.\"Date\")::INT = date_part(\'year\', now() AT TIME ZONE \'UTC\')::INT))) AND (t5.\"MeterType\" = 1)) AND t5.\"Active\")) AND (t0.\"DivisionID\" = t6.\"DivisionID\")LIMIT 1)
EnergyUsageSitewise=SELECT (SELECT t7.\"SiteName\" FROM public. \"LenzDailyData\" AS l1 INNER JOIN (SELECT b1.\"EquipmentId\", b1.\"Active\", b1.\"CompanyId\", b1.\"Created\", b1.\"CreatedBy\", b1.\"Description\", b1.\"DeviceId\", b1.\"EquipmentCode\", b1.\"Hierarchyid\", b1.\"Label1\", b1.\"Label2\", b1.\"Label3\", b1.\"Label4\", b1.\"Label5\", b1.\"LastModified\", b1.\"LastModifiedBy\", b1.\"Latitude\", b1.\"Location\", b1.\"Longitude\", b1.\"ModelId\", b1.\"SiteId\", b1.\"SubCategoryId\", e1.\"AmpereRating\", e1.\"BaudRate\", e1.\"BreakingCapacity\", e1.\"Capacity\", e1.\"CommandString\", e1.\"HierarchyPath\", e1.\"IsBBTempMonitored\", e1.\"IsBSConnected\", e1.\"IsGenset\", e1.\"IsLMConnected\", e1.\"IsVirtualMeter\", e1.\"LenzEquipmentType\", e1.\"LowLoadConsumption\", e1.\"MeterNo\", e1.\"MeterType\", e1.\"ParentEquipmentHierarchyID\", e1.\"Parity\", e1.\"RatedLoading\", e1.\"RatedPower\", e1.\"SlaveID\", e1.\"StopBit\", e1.\"TankCapacity\", e1.\"TankSize\", e1.\"TypeOfBreaker\" FROM public. \"BaseEquipment\" AS b1 INNER JOIN \"EquipmentHierarchy\" AS e1 ON b1.\"EquipmentId\" = e1.\"EquipmentId\" WHERE b1.\"CompanyId\" = 5) AS t5 ON l1.\"EquipmentId\" = t5.\"EquipmentId\" INNER JOIN (SELECT s3.\"SubCategoryId\", s3.\"CompanyId\", s3.\"Created\", s3.\"CreatedBy\", s3.\"ImageUrl\", s3.\"LastModified\", s3.\"LastModifiedBy\", s3.\"ProductCategoryID\", s3.\"SubCategoryCode\", s3.\"SubCategoryName\" FROM public. \"SubCategory\" AS s3 WHERE s3.\"CompanyId\" = 5) AS t6 ON t5.\"SubCategoryId\" = t6.\"SubCategoryId\" INNER JOIN (SELECT s4.\"SiteId\", s4.\"Active\", s4.\"Address\", s4.\"City\", s4.\"CompanyId\", s4.\"CountryKey\", s4.\"CreateSiteGeoFence\", s4.\"Created\", s4.\"CreatedBy\", s4.\"LastModified\", s4.\"LastModifiedBy\", s4.\"PostalCode\", s4.\"SiteCode\", s4.\"SiteName\", s4.\"TimeZoneInMinutes\" FROM public.\"Sites\" AS s4 WHERE s4.\"CompanyId\" = 5) AS t7 ON t5.\"SiteId\" = t7.\"SiteId\" WHERE ((l1.\"CompanyId\" = 5) AND ((((((t5.\"CompanyId\" = 5) AND t7.\"Active\") AND ((date_part(\'month\', l1.\"Date\")::INT = date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT) AND (date_part(\'year\', l1.\"Date\")::INT = date_part(\'year\', now() AT TIME ZONE \'UTC\')::INT))) AND ((t6.\"SubCategoryCode\" = \'Mains\'))) AND (t5.\"MeterType\" = 1)) AND t5.\"Active\")) AND (t1.\"SiteId\" = t7.\"SiteId\") LIMIT 1) AS \"SiteName\", true AS \"PFFlagkWh\", round(COALESCE(SUM(l.\"TotalKwH\"), 0.0)) AS \"PFKwH\" FROM public. \"LenzDailyData\" AS l INNER JOIN (SELECT b.\"EquipmentId\", b.\"Active\", b.\"CompanyId\", b.\"SiteId\", b.\"SubCategoryId\", e.\"MeterType\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON l.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN (SELECT s.\"SubCategoryId\", s.\"SubCategoryCode\" FROM public. \"SubCategory\" AS s WHERE s.\"CompanyId\" = 5) AS t0 ON t.\"SubCategoryId\" = t0.\"SubCategoryId\" INNER JOIN (SELECT s0.\"SiteId\", s0.\"Active\" FROM public. \"Sites\" AS s0 WHERE s0.\"CompanyId\" = 5) AS t1 ON t.\"SiteId\" = t1.\"SiteId\" WHERE (l.\"CompanyId\" = 5) AND ((((((t.\"CompanyId\" = 5) AND t1.\"Active\") AND ((date_part(\'month\', l.\"Date\")::INT = date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT) AND (date_part(\'year\', l.\"Date\")::INT = date_part(\'year\', now() AT TIME ZONE \'UTC\')::INT))) AND ((t0.\"SubCategoryCode\" = \'Mains\'))) AND (t.\"MeterType\" = 1)) AND t.\"Active\")GROUP BY t1.\"SiteId\" ORDER BY (SELECT t7.\"SiteName\" FROM public. \"LenzDailyData\" AS l1 INNER JOIN (SELECT b1.\"EquipmentId\", b1.\"Active\", b1.\"CompanyId\", b1.\"Created\", b1.\"CreatedBy\", b1.\"Description\", b1.\"DeviceId\", b1.\"EquipmentCode\", b1.\"Hierarchyid\", b1.\"Label1\", b1.\"Label2\", b1.\"Label3\", b1.\"Label4\", b1.\"Label5\", b1.\"LastModified\", b1.\"LastModifiedBy\", b1.\"Latitude\", b1.\"Location\", b1.\"Longitude\", b1.\"ModelId\", b1.\"SiteId\", b1.\"SubCategoryId\", e1.\"AmpereRating\", e1.\"BaudRate\", e1.\"BreakingCapacity\", e1.\"Capacity\", e1.\"CommandString\", e1.\"HierarchyPath\", e1.\"IsBBTempMonitored\", e1.\"IsBSConnected\", e1.\"IsGenset\", e1.\"IsLMConnected\", e1.\"IsVirtualMeter\", e1.\"LenzEquipmentType\", e1.\"LowLoadConsumption\", e1.\"MeterNo\", e1.\"MeterType\", e1.\"ParentEquipmentHierarchyID\", e1.\"Parity\", e1.\"RatedLoading\", e1.\"RatedPower\", e1.\"SlaveID\", e1.\"StopBit\", e1.\"TankCapacity\", e1.\"TankSize\", e1.\"TypeOfBreaker\" FROM public. \"BaseEquipment\" AS b1 INNER JOIN \"EquipmentHierarchy\" AS e1 ON b1.\"EquipmentId\" = e1.\"EquipmentId\" WHERE b1.\"CompanyId\" = 5) AS t5 ON l1.\"EquipmentId\" = t5.\"EquipmentId\" INNER JOIN (SELECT s3.\"SubCategoryId\", s3.\"CompanyId\", s3.\"Created\", s3.\"CreatedBy\", s3.\"ImageUrl\", s3.\"LastModified\", s3.\"LastModifiedBy\", s3.\"ProductCategoryID\", s3.\"SubCategoryCode\", s3.\"SubCategoryName\" FROM public.\"SubCategory\" AS s3 WHERE s3.\"CompanyId\" = 5) AS t6 ON t5.\"SubCategoryId\" = t6.\"SubCategoryId\" INNER JOIN (SELECT s4.\"SiteId\", s4.\"Active\", s4.\"Address\", s4.\"City\", s4.\"CompanyId\", s4.\"CountryKey\", s4.\"CreateSiteGeoFence\", s4.\"Created\", s4.\"CreatedBy\", s4.\"LastModified\", s4.\"LastModifiedBy\", s4.\"PostalCode\", s4.\"SiteCode\", s4.\"SiteName\", s4.\"TimeZoneInMinutes\" FROM public. \"Sites\" AS s4 WHERE s4.\"CompanyId\" = 5) AS t7 ON t5.\"SiteId\" = t7.\"SiteId\" WHERE ((l1.\"CompanyId\" = 5) AND ((((((t5.\"CompanyId\" = 5) AND t7.\"Active\") AND ((date_part(\'month\', l1.\"Date\")::INT = date_part(\'month\', now() AT TIME ZONE \'UTC\')::INT) AND (date_part(\'year\', l1.\"Date\")::INT = date_part(\'year\', now() AT TIME ZONE \'UTC\')::INT))) AND ((t6.\"SubCategoryCode\" = \'Mains\'))) AND (t5.\"MeterType\" = 1)) AND t5.\"Active\")) AND (t1.\"SiteId\" = t7.\"SiteId\")LIMIT 1)

EnergyUsageCostMonthWiseGraph=select "Cost"  from "LenzDailyData" ldd where ldd."EquipmentId" = (select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='03 PH MSEDCL 4000Amp. Panel')and ldd."Date" between NOW() + INTERVAL '-7 DAY' and NOW() order by "Date" desc  ;
EnergyUsageCostMonthWiseGraph=SELECT t1.c1, t2."Date" FROM ( SELECT date_part('month', l."Date")::INT AS c, date_part('year', l."Date")::INT AS c0, COALESCE(SUM(l."Cost"), 0.0)::double precision AS c1 FROM "LenzDailyData" AS l INNER JOIN ( SELECT b."EquipmentId", b."Active", b."CompanyId", b."SubCategoryId", e."IsCalculation", e."MeterType" FROM "BaseEquipment" AS b INNER JOIN "EquipmentHierarchy" AS e ON b."EquipmentId" = e."EquipmentId" WHERE b."CompanyId" = 5 ) AS t ON l."EquipmentId" = t."EquipmentId" INNER JOIN ( SELECT s."SubCategoryId", s."SubCategoryCode" FROM "SubCategory" AS s WHERE s."CompanyId" = 5 ) AS t0 ON t."SubCategoryId" = t0."SubCategoryId"  WHERE (l."CompanyId" = 5) AND ((((t."CompanyId" = 5) AND ((t0."SubCategoryCode" = 'Mains') OR t."IsCalculation")) AND (t."MeterType" = 1)) AND t."Active") GROUP BY date_part('month', l."Date")::INT, date_part('year', l."Date")::INT ) AS t1 LEFT JOIN LATERAL ( SELECT l0."Date", 1 AS c  FROM "LenzDailyData" AS l0 INNER JOIN ( SELECT b0."EquipmentId", b0."Active", b0."CompanyId", b0."SubCategoryId", e0."IsCalculation", e0."MeterType"  FROM "BaseEquipment" AS b0 INNER JOIN "EquipmentHierarchy" AS e0 ON b0."EquipmentId" = e0."EquipmentId"  WHERE b0."CompanyId" = 5 ) AS t3 ON l0."EquipmentId" = t3."EquipmentId" INNER JOIN (  SELECT s0."SubCategoryId", s0."SubCategoryCode" FROM "SubCategory" AS s0 WHERE s0."CompanyId" = 5 ) AS t4 ON t3."SubCategoryId" = t4."SubCategoryId" WHERE ((l0."CompanyId" = 5) AND ((((t3."CompanyId" = 5) AND ((t4."SubCategoryCode" = 'Mains') OR t3."IsCalculation")) AND (t3."MeterType" = 1)) AND t3."Active")) AND ((t1.c = date_part('month', l0."Date")::INT) AND (t1.c0 = date_part('year', l0."Date")::INT))  LIMIT 1  ) AS t2 ON TRUE ORDER BY t1.c0, t1.c
EnergyUsageCostDivisionWiseGraph=select sum("Cost")  from "Division" d inner join "DivisionMap" dm on dm."DivisionID" = d."DivisionID" inner join "LenzDailyData" ldd on ldd."EquipmentId" = dm."EquipmentId" where d."DivisionName" in ('ACRREF','ACR Store','ACRVAC2','Corporate','PGS')  and ldd."Date" between NOW() - INTERVAL '1 month' and NOW() group by d."DivisionName"
EnergyUsageCostSiteWiseGraph=select sum("Cost"),S."SiteName"  from "Sites" s inner join  "BaseEquipment" be  on be."SiteId"  = s."SiteId"  inner join "LenzDailyData" ldd on ldd."EquipmentId" = be."EquipmentId"where s."SiteName"  in ('KTL')  and ldd."Date" between NOW() - INTERVAL ' 1 month' and NOW()group by S."SiteName" 

MaximumDemandMain=select "MaxDemand" from "LenzHourlyData" lhd where "EquipmentId" =7 order by "Date" desc limit 20
MaximumDemandIND=select max(ldd."MaxDemand")  from "LenzDailyData" ldd where ldd."EquipmentId" = (select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='11 PH Dispatch') and ldd."Date" between NOW() + INTERVAL '-2 DAY' and NOW() union select max(ldd."MaxDemand")  from "LenzDailyData" ldd where ldd."EquipmentId" =(select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='51 Ammonia Test Bed') and ldd."Date" between NOW() + INTERVAL '-2 DAY' and NOW() union select max(ldd."MaxDemand")  from "LenzDailyData" ldd where ldd."EquipmentId" =(select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='09 PH Machine shop') and ldd."Date" between NOW() + INTERVAL '-2 DAY' and NOW() union select max(ldd."MaxDemand")  from "LenzDailyData" ldd  where ldd."EquipmentId" =(select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='Huston Hydraulic-Demo') and ldd."Date" between NOW() + INTERVAL '-2 DAY' and NOW() union select max(ldd."MaxDemand")  from "LenzDailyData" ldd where ldd."EquipmentId" =(select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='47 ACR Assembly Test Bed 4') and ldd."Date" between NOW() + INTERVAL '-2 DAY' and NOW() union select max(ldd."MaxDemand")  from "LenzDailyData" ldd  where ldd."EquipmentId" =(select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='12 PH Compressor Room') and ldd."Date" between NOW() + INTERVAL '-2 DAY' and NOW()  union select max(ldd."MaxDemand")  from "LenzDailyData" ldd  where ldd."EquipmentId" =(select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='SR Furnace') and ldd."Date" between NOW() + INTERVAL '-2 DAY' and NOW()  union select max(ldd."MaxDemand")  from "LenzDailyData" ldd where ldd."EquipmentId" =(select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='06 PH Outgoing Change over panel') and ldd."Date" between NOW() + INTERVAL '-2 DAY' and NOW() union select max(ldd."MaxDemand")  from "LenzDailyData" ldd where ldd."EquipmentId" =(select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='19 New Phosphating Plant') and ldd."Date" between NOW() + INTERVAL '-2 DAY' and NOW() union select max(ldd."MaxDemand")  from "LenzDailyData" ldd where ldd."EquipmentId" =(select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='10 PH ACR assembly SHOP') and ldd."Date" between NOW() + INTERVAL '-2 DAY' and NOW() ORDER BY max desc;
DeviceID=SELECT t.\"Description\" AS \"MachineDesc\", c.\"CompanyName\" AS \"Manufacturer\", \'2022\' AS \"Model\", t.\"RatedPower\", m.\"EquipmentId\" AS \"EquipmentHierarchyID\", m.\"DEVICEID\" AS \"DeviceID\", m.\"UPDATEDDATA\" AS \"UpdateData\", m.\"LASTUPDATEDDATE\" AS \"LastReportedTime\", CASE WHEN (m.\"UPDATEDDATA\"->>\'MachineStatus\' = \'On\') AND (m.\"LASTUPDATEDDATE\" > date_trunc(\'hour\', now()) - INTERVAL \'1 hour\') THEN \'On\' WHEN (m.\"UPDATEDDATA\"->>\'MachineStatus\' = \'Off\') OR (m.\"LASTUPDATEDDATE\" < date_trunc(\'hour\', now()) - INTERVAL \'1 hour\') THEN \'Off\' WHEN (m.\"UPDATEDDATA\"->>\'MachineStatus\' = \'Idle\') AND (m.\"LASTUPDATEDDATE\" > date_trunc(\'hour\', now()) - INTERVAL \'1 hour\') THEN \'Idle\' WHEN (m.\"UPDATEDDATA\"->>\'ChargingStatus\' = \'Charging\') AND (m.\"LASTUPDATEDDATE\" > date_trunc(\'hour\', now()) - INTERVAL \'1 hour\') THEN \'Charging\' ELSE NULL END AS \"Status\", m.\"UPDATEDDATA\"->>\'B_Phase_Voltage\' as voltage1, m.\"UPDATEDDATA\"->>\'Y_Phase_Voltage\' as voltage2, m.\"UPDATEDDATA\"->>\'R_Phase_Voltage\' as voltage3, m.\"UPDATEDDATA\"->>\'B_Phase_Current\' as current1, m.\"UPDATEDDATA\"->>\'R_Phase_Current\' as current2, m.\"UPDATEDDATA\"->>\'Y_Phase_Current\' as current3, m.\"UPDATEDDATA\"->>\'Total_Active_Power_kW\' as TApower, m.\"UPDATEDDATA\"->>\'Average_Power_Factor\' as PF, m.\"UPDATEDDATA\"->>\'MachineStatus\' as Status FROM public. \"MachineDataUpdate\" AS m INNER JOIN (SELECT b.\"EquipmentId\", b.\"CompanyId\", b.\"Description\", e.\"RatedPower\" FROM public. \"BaseEquipment\" AS b INNER JOIN \"EquipmentHierarchy\" AS e ON b.\"EquipmentId\" = e.\"EquipmentId\" WHERE b.\"CompanyId\" = 5) AS t ON m.\"EquipmentId\" = t.\"EquipmentId\" INNER JOIN \"Company\" AS c ON t.\"CompanyId\" = c.\"CompanyId\" WHERE m.\"EquipmentId\" = 7 LIMIT 2
SLDparentnode=select count(eh."ParentEquipmentHierarchyID")   from "EquipmentHierarchy" eh where "ParentEquipmentHierarchyID" =  (select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='KTL')
SLDChildnode=select count(eh."ParentEquipmentHierarchyID") from "EquipmentHierarchy" eh where "ParentEquipmentHierarchyID" =  (select distinct Be."EquipmentId" from "BaseEquipment" Be where Be."Description" ='03 PH MSEDCL 4000Amp. Panel')
 
MachineSpecificationfrequency=select mdu."UPDATEDDATA"->>'Frequency' as Frequency from  "MachineDataUpdate" mdu  where "EquipmentId" = 31
MachineSpecificationPowerFactor=select mdu."UPDATEDDATA"->>'Average_Power_Factor' as  power  from  "MachineDataUpdate" mdu  where "EquipmentId" = 31
MachineSpecificationPower=select mdu."UPDATEDDATA"->>'Total_Active_Power_kW' as  Power  from  "MachineDataUpdate" mdu  where "EquipmentId" = 31
MachineSpecificationStatus=select mdu."UPDATEDDATA"->>'MachineStatus' as status  from  "MachineDataUpdate" mdu  where "EquipmentId" = 31
MachineSpecificationVoltage=select mdu."UPDATEDDATA"->>'R_Phase_Voltage' as R_Phase_Voltage  from  "MachineDataUpdate" mdu  where "EquipmentId" = 31
MachineSpecificationCurrent=select mdu."UPDATEDDATA"->>'R_Phase_Current' as R_Phase_Current  from  "MachineDataUpdate" mdu  where "EquipmentId" = 31
MachineSpecificationVTHD=select mdu."UPDATEDDATA"->>'R_Phase_Voltage_Total_Harmonic_Distortion' as R_Phase_Voltage_Total_Harmonic_Distortion from  "MachineDataUpdate" mdu  where "EquipmentId" = 31
MachineSpecificationCTHD=select mdu."UPDATEDDATA"->>'R_Phase_Current_Total_Harmonic_Distortion' as R_Phase_Current_Total_Harmonic_Distortion from  "MachineDataUpdate" mdu  where "EquipmentId" = 31
 
SECReportMaster=select sc."ProductCode", sc."ProductName", s."ReportDate" ,s."EnergyConsumption"  from "SECReport" s inner join "SECProductConfig" sc on s."SECProductID" = sc."SECProductID"  where sc."ProductCode"  in ('100')  and s."ReportDate" between now() - INTERVAL '1 day' and NOW() union select  sc."ProductCode", sc."ProductName", s."ReportDate" ,s."EnergyConsumption"  from "SECReport" s inner join "SECProductConfig" sc on s."SECProductID" = sc."SECProductID"  where sc."ProductCode"  in ('PC-001')  and s."ReportDate" between now() - INTERVAL '1 day' and NOW() union  select  sc."ProductCode", sc."ProductName", s."ReportDate" ,s."EnergyConsumption"  from "SECReport" s inner join "SECProductConfig" sc on s."SECProductID" = sc."SECProductID"  where sc."ProductCode"  in ('PC-002')  and s."ReportDate" between now() - INTERVAL '1 day' and NOW() union  select  sc."ProductCode", sc."ProductName", s."ReportDate" ,s."EnergyConsumption"  from "SECReport" s inner join "SECProductConfig" sc on s."SECProductID" = sc."SECProductID"  where sc."ProductCode"  in ('p1')  and s."ReportDate" between now() - INTERVAL '1 day' and NOW()
